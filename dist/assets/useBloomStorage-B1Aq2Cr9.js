var $=Object.defineProperty;var k=(i,r,a)=>r in i?$(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a;var S=(i,r,a)=>k(i,typeof r!="symbol"?r+"":r,a);import{r as c}from"./router-Dk50FOzW.js";import{d as f}from"./index-UunlnGXq.js";class F{constructor(){S(this,"listeners",new Map)}emit(r,a){(this.listeners.get(r)||[]).forEach(u=>u(a))}subscribe(r,a){const s=this.listeners.get(r)||[];return s.push(a),this.listeners.set(r,s),()=>{const u=(this.listeners.get(r)||[]).filter(g=>g!==a);this.listeners.set(r,u)}}}const m=new F;function E(i={}){const{prefix:r="bloom",serialize:a=!0}=i,s=c.useCallback(e=>`${r}.${e}`,[r]),u=c.useCallback(async(e,t)=>{try{const o=s(e),l=localStorage.getItem(o);if(l!==null)return a?JSON.parse(l):l;const n=f[e];return n!==void 0?n:t!==void 0?t:null}catch(o){console.error(`[BloomStorage] Failed to get ${e}:`,o);const l=f[e];return l!==void 0?l:t??null}},[s,a]),g=c.useCallback(async(e,t)=>{try{const o=s(e),l=a?JSON.stringify(t):String(t);return localStorage.setItem(o,l),m.emit(e,t),!0}catch(o){return console.error(`[BloomStorage] Failed to set ${e}:`,o),!1}},[s,a]),h=c.useCallback(async e=>{try{const t=s(e);return localStorage.removeItem(t),m.emit(e,void 0),!0}catch(t){return console.error(`[BloomStorage] Failed to remove ${e}:`,t),!1}},[s]),d=c.useCallback(async e=>{try{const t=s(e);return localStorage.getItem(t)!==null}catch(t){return console.error(`[BloomStorage] Failed to check ${e}:`,t),!1}},[s]),b=c.useCallback(async e=>{const t={};return await Promise.all(e.map(async o=>{t[o]=await u(o)})),t},[u]),y=c.useCallback(async e=>{try{return await Promise.all(Object.entries(e).map(([t,o])=>g(t,o))),!0}catch(t){return console.error("[BloomStorage] Failed to set multiple values:",t),!1}},[g]),p=c.useCallback(async()=>{try{const e=[];for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);o&&o.startsWith(`${r}.`)&&e.push(o)}return e.forEach(t=>localStorage.removeItem(t)),!0}catch(e){return console.error("[BloomStorage] Failed to clear storage:",e),!1}},[r]),C=c.useCallback((e,t)=>m.subscribe(e,t),[]),v=c.useCallback(async()=>{try{const e={};for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);if(o&&o.startsWith(`${r}.`)){const l=o.replace(`${r}.`,""),n=localStorage.getItem(o);n!==null&&(e[l]=a?JSON.parse(n):n)}}return e}catch(e){return console.error("[BloomStorage] Failed to get all data:",e),{}}},[r,a]),B=c.useCallback(async()=>{try{let e=0,t=0;for(let o=0;o<localStorage.length;o++){const l=localStorage.key(o);if(l&&l.startsWith(`${r}.`)){const n=localStorage.getItem(l);n&&(e+=l.length+n.length,t++)}}return{itemCount:t,totalSize:e,totalSizeKB:Math.round(e/1024*100)/100,prefix:r}}catch(e){return console.error("[BloomStorage] Failed to get storage info:",e),{itemCount:0,totalSize:0,totalSizeKB:0,prefix:r}}},[r]);return{get:u,set:g,remove:h,has:d,getMultiple:b,setMultiple:y,getAll:v,clear:p,subscribe:C,getStorageInfo:B,prefix:r}}export{E as u};
