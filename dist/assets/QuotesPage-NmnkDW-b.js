import{j as e,f as L,u as D,d as N,b as I,o as M,i as z}from"./uikit-DoHVGtBE.js";import{r as o}from"./router-Dib99Hsw.js";import{u as _}from"./useBloomStorage-D5Yz0Twd.js";import{d as H,Q as W,H as G,S as K,B as V,L as U,R as X}from"./bloom-platform-D4J8yDdA.js";import"./vendor-DJG_os-6.js";import"./bloom-redux-DOzirk1u.js";const E=new Map;function Y(){const[r,s]=o.useState(!1),[u,m]=o.useState(null),h=o.useCallback(()=>{E.clear()},[]),x=o.useCallback(c=>{const a=E.get(c);return a&&Date.now()<a.expiry?{success:!0,data:a.data,cached:!0}:(a&&E.delete(c),null)},[]),v=o.useCallback((c,a,y)=>{E.set(c,{data:a,timestamp:Date.now(),expiry:Date.now()+y})},[]),l=o.useCallback(async(c,a={})=>{const{timeout:y=H["api-timeout"],enableCache:S=H["enable-caching"]!==!1,cacheTime:O=3e5,headers:k={},retries:A=3,...C}=a,P=!C.method||C.method==="GET"?`${c}_${JSON.stringify({headers:k,...C})}`:"";if(S&&P){const b=x(P);if(b)return b}s(!0),m(null);for(let b=1;b<=A;b++)try{const w=new AbortController,Q=setTimeout(()=>w.abort(),y),R={"Content-Type":"application/json",...k},p=await fetch(c,{...C,headers:R,signal:w.signal});clearTimeout(Q);let F;const T=p.headers.get("content-type")||"";if(T.includes("application/json")?F=await p.json():T.includes("text/")?F=await p.text():F=await p.blob(),p.ok)return S&&P&&v(P,F,O),s(!1),{success:!0,data:F,status:p.status,cached:!1};throw new Error(`HTTP ${p.status}: ${p.statusText}`)}catch(w){if(console.error(`[API] Attempt ${b} failed:`,w),w.name==="AbortError"||w.message?.includes("HTTP 4"))break;if(b===A){const Q=w.name==="AbortError"?"Request timed out":w.message||"Network request failed";return m(Q),s(!1),{success:!1,error:Q,status:0}}await new Promise(Q=>setTimeout(Q,Math.pow(2,b)*1e3))}return s(!1),{success:!1,error:"Request failed after all retries"}},[x,v]),n=o.useCallback((c,a={})=>l(c,{...a,method:"GET"}),[l]),g=o.useCallback((c,a,y={})=>l(c,{...y,method:"POST",body:a?JSON.stringify(a):void 0}),[l]),j=o.useCallback((c,a,y={})=>l(c,{...y,method:"PUT",body:a?JSON.stringify(a):void 0}),[l]),$=o.useCallback((c,a={})=>l(c,{...a,method:"DELETE"}),[l]);return{loading:r,error:u,apiCall:l,apiGet:n,apiPost:g,apiPut:j,apiDelete:$,clearCache:h,clearError:()=>m(null),isOnline:typeof navigator<"u"?navigator.onLine:!0}}function Z(){const{get:r,set:s,isReady:u}=_(),{apiGet:m}=Y(),[h,x]=o.useState([]),[v,l]=o.useState(null),[n,g]=o.useState([]),[j,$]=o.useState({autoRefresh:!0,refreshInterval:3e4,showAuthor:!0,quotesPerPage:6}),[c,a]=o.useState({quotes:!1,featured:!1,refresh:!1}),[y,S]=o.useState(null);o.useEffect(()=>{u&&(O(),k(),A(),C())},[u]),o.useEffect(()=>{if(!j.autoRefresh)return;const t=setInterval(()=>{P()},j.refreshInterval);return()=>clearInterval(t)},[j.autoRefresh,j.refreshInterval]);const O=async()=>{try{const t=await r("quotes.autoRefresh",!0),i=await r("quotes.refreshInterval",3e4),d=await r("quotes.showAuthor",!0),f=await r("quotes.quotesPerPage",6);$({autoRefresh:t,refreshInterval:i,showAuthor:d,quotesPerPage:f})}catch(t){console.error("[Quotes] Failed to load settings:",t)}},k=async()=>{try{const t=await r("quotes.favorites",[]);g(t)}catch(t){console.error("[Quotes] Failed to load favorites:",t)}},A=async()=>{a(t=>({...t,quotes:!0})),S(null);try{console.log("[Quotes] Loading advice from Advice Slip API...");const t=Array(j.quotesPerPage).fill(null).map((f,B)=>m("https://api.adviceslip.com/advice").then(q=>({response:q,index:B}))),i=await Promise.all(t),d=[];if(i.forEach(({response:f,index:B})=>{if(f.success&&f.data?.slip){const q=f.data.slip;d.push({id:`advice-${q.id}-${Date.now()}-${B}`,content:q.advice,author:"Anonymous Wisdom",tags:["advice","wisdom"],length:q.advice.length})}}),d.length>0)x(d),console.log("[Quotes] Advice Slip API successful!",d);else throw new Error("No advice received from API")}catch(t){console.error("[Quotes] Advice Slip API failed:",t),S("Failed to load advice from API. Please try refreshing.")}finally{a(t=>({...t,quotes:!1}))}},C=async()=>{a(t=>({...t,featured:!0}));try{console.log("[Quotes] Loading featured advice...");const t=await m("https://api.adviceslip.com/advice");if(t.success&&t.data?.slip){const i=t.data.slip,d={id:`featured-advice-${i.id}-${Date.now()}`,content:i.advice,author:"Featured Wisdom",tags:["featured","advice"],length:i.advice.length};l(d),console.log("[Quotes] Featured advice loaded:",d)}else throw new Error("No featured advice received")}catch(t){console.error("[Quotes] Failed to load featured advice:",t)}finally{a(t=>({...t,featured:!1}))}},P=o.useCallback(async()=>{a(t=>({...t,refresh:!0}));try{await Promise.all([A(),C()])}finally{a(t=>({...t,refresh:!1}))}},[j.quotesPerPage]),b=o.useCallback(async(t,i)=>{try{$(d=>({...d,[t]:i})),await s(`quotes.${t}`,i),t==="quotesPerPage"&&A()}catch(d){console.error(`[Quotes] Failed to update ${t}:`,d),$(f=>({...f,[t]:j[t]}))}},[s]),w=o.useCallback(async t=>{try{const i=n.includes(t)?n.filter(d=>d!==t):[...n,t];g(i),await s("quotes.favorites",i)}catch(i){console.error("[Quotes] Failed to update favorites:",i),g(n)}},[n,s]),Q=async t=>{const i=`"${t.content}" — ${t.author}`;if(navigator.share)try{await navigator.share({title:"Inspirational Advice",text:i,url:window.location.href})}catch{R(i)}else R(i)},R=async t=>{try{await navigator.clipboard.writeText(t),console.log("Advice copied to clipboard")}catch(i){console.error("Failed to copy to clipboard:",i)}},p=o.useCallback(()=>h.filter(t=>n.includes(t.id)),[h,n]),F=o.useCallback(async()=>{try{g([]),await s("quotes.favorites",[])}catch(t){console.error("[Quotes] Failed to clear favorites:",t)}},[s]),T=o.useCallback(()=>{const t=p(),i=JSON.stringify(t,null,2),d=new Blob([i],{type:"application/json"}),f=document.createElement("a");f.href=URL.createObjectURL(d),f.download="bloom-favorite-quotes.json",f.click(),URL.revokeObjectURL(f.href)},[p]);return{quotes:h,featuredQuote:v,favorites:n,settings:j,loading:c,error:y,refreshQuotes:P,updateSetting:b,toggleFavorite:w,shareQuote:Q,clearFavorites:F,exportFavorites:T,getFavorites:p,isReady:!c.quotes&&!c.featured&&u}}function J({quote:r,featured:s=!1,showAuthor:u=!0,onFavorite:m,onShare:h,isFavorited:x=!1,className:v=""}){const l=s?"border-primary bg-gradient-to-br from-primary/5 to-accent/5":"hover:shadow-md transition-shadow duration-200";return e.jsx(L,{className:`${l} ${v}`,children:e.jsxs(D,{className:`p-6 ${s?"md:p-8":""}`,children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(W,{className:`${s?"w-8 h-8":"w-6 h-6"} text-primary/60`})}),e.jsx("blockquote",{className:`text-center mb-6 ${s?"text-xl md:text-2xl":"text-lg"} leading-relaxed`,children:e.jsxs("p",{className:"text-foreground font-medium italic",children:['"',r.content,'"']})}),u&&e.jsx("div",{className:"text-center mb-6",children:e.jsxs("p",{className:`text-muted-foreground ${s?"text-lg":"text-base"}`,children:["— ",r.author]})}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-6",children:r.tags.slice(0,3).map((n,g)=>e.jsx(N,{variant:"secondary",className:"text-xs",children:n},g))}),e.jsxs("div",{className:"flex justify-center gap-3",children:[m&&e.jsxs(I,{variant:"ghost",size:"sm",onClick:m,className:`${x?"text-red-500 hover:text-red-600":"text-muted-foreground"}`,children:[e.jsx(G,{className:`w-4 h-4 mr-2 ${x?"fill-current":""}`}),x?"Favorited":"Favorite"]}),h&&e.jsxs(I,{variant:"ghost",size:"sm",onClick:h,className:"text-muted-foreground",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Share"]})]}),s&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(N,{className:"bg-primary/10 text-primary border-primary/20",children:"✨ Featured Quote"})}),r.length&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs(N,{variant:"outline",className:"text-xs",children:[r.length," characters"]})})]})})}function ee({quotes:r,loading:s=!1,showAuthor:u=!0,onFavorite:m,onShare:h,favoriteIds:x=[],emptyMessage:v="No quotes available",className:l=""}){return s?e.jsx("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 ${l}`,children:Array.from({length:6}).map((n,g)=>e.jsx(L,{className:"animate-pulse",children:e.jsxs(D,{className:"p-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-6 h-6 bg-muted rounded"})}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-full"}),e.jsx("div",{className:"h-4 bg-muted rounded w-4/5 mx-auto"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/5 mx-auto"})]}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto mb-6"}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-20"}),e.jsx("div",{className:"h-8 bg-muted rounded w-20"})]})]})},g))}):!s&&r.length===0?e.jsx("div",{className:`text-center py-12 ${l}`,children:e.jsx(L,{children:e.jsxs(D,{className:"p-12",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-foreground",children:"No Quotes Found"}),e.jsx("p",{className:"text-muted-foreground",children:v})]})})}):e.jsxs("div",{className:l,children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",children:[r.length," quotes"]}),x.length>0&&e.jsxs(N,{variant:"secondary",children:[x.length," favorites"]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map((n,g)=>e.jsx("div",{className:"animate-bloom-fade-in",style:{animationDelay:`${g*.1}s`},children:e.jsx(J,{quote:n,showAuthor:u,onFavorite:m?()=>m(n.id):void 0,onShare:h?()=>h(n):void 0,isFavorited:x.includes(n.id)})},n.id))}),r.length>0&&e.jsx("div",{className:"text-center mt-8",children:e.jsxs(N,{variant:"outline",className:"text-xs",children:["Showing ",r.length," quotes"]})})]})}function ne(){const{quotes:r,featuredQuote:s,loading:u,error:m,settings:h,refreshQuotes:x,getFavorites:v,toggleFavorite:l,shareQuote:n}=Z();return e.jsxs("div",{className:"space-y-16",children:[e.jsxs("section",{className:"py-16 px-8 text-center border-b border-border",children:[e.jsx(N,{variant:"secondary",className:"mb-6",children:"🌸 Daily Inspiration"}),e.jsx("h1",{className:"text-5xl font-bold mb-6",children:e.jsx("span",{className:"bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"Quotes"})}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto mb-8",children:"Discover wisdom and inspiration from great minds throughout history. Let these quotes motivate and guide your journey."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[e.jsx(I,{onClick:x,disabled:u.quotes,variant:"outline",className:"min-w-32",children:u.quotes?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"New Quotes"]})}),e.jsxs(I,{onClick:()=>window.location.href="#favorites",variant:"ghost",className:"min-w-32",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Favorites (",v().length,")"]})]})]}),m&&e.jsx("div",{className:"max-w-4xl mx-auto px-8 py-8",children:e.jsx(M,{variant:"destructive",children:e.jsxs(z,{children:[m,". Please try refreshing the page."]})})}),s&&!u.featured&&e.jsx("section",{className:"py-16 px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-8",children:"Quote of the Day"}),e.jsx(J,{quote:s,featured:!0,onFavorite:()=>l(s.id),onShare:()=>n(s),showAuthor:h.showAuthor})]})}),u.featured&&e.jsx("section",{className:"py-16 px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsx(L,{children:e.jsxs(D,{className:"p-12",children:[e.jsx(U,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading featured quote..."})]})})})}),e.jsx("section",{className:"py-16 px-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Latest Quotes"}),e.jsxs(N,{variant:"outline",children:[r.length," quotes loaded"]})]}),e.jsx(ee,{quotes:r,loading:u.quotes,onFavorite:l,onShare:n,showAuthor:h.showAuthor,emptyMessage:"No quotes available. Try refreshing to load new quotes."})]})}),h.autoRefresh&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx(N,{variant:"secondary",className:"text-xs",children:"Auto-refresh enabled"})})]})}export{ne as default};
