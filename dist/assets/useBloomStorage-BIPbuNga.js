import{r as u}from"./router-Dib99Hsw.js";import{u as I,d as C,h,b as z,c as E}from"./bloom-redux-DOzirk1u.js";import{d as y}from"./bloom-platform-DoxVIcPv.js";function A(a){const s=I(),i=C(c=>c[a]),l=h(a);return{state:i||{},dispatch:s,isReady:l}}function f(a){if(typeof a=="string")return a.replace(/<script/gi,"&lt;script").replace(/<\/script>/gi,"&lt;/script&gt;").replace(/javascript:/gi,"javascript_blocked:").replace(/on\w+=/gi,"blocked_event=");if(typeof a=="object"&&a!==null){if(Array.isArray(a))return a.map(i=>f(i));const s={};return Object.entries(a).forEach(([i,l])=>{s[i]=f(l)}),s}return a}function d(a){return/^[a-zA-Z0-9._-]+$/.test(a)}function S(a){const s=[/password/i,/token/i,/secret/i,/api[_-]?key/i,/private[_-]?key/i,/credit[_-]?card/i,/ssn/i,/social[_-]?security/i],i=typeof a=="string"?a:JSON.stringify(a);return s.some(l=>l.test(i))}function D(a={}){const{prefix:s="bloom",autoHydrate:i=!0}=a;h("storage")||z(E("STORAGE","storage"));const{state:l,dispatch:c,isReady:m}=A("storage");u.useEffect(()=>{if(!i||!m)return;(()=>{const t={};try{Object.keys(localStorage).forEach(r=>{if(r.startsWith(`${s}.`)){const o=r.replace(`${s}.`,"");if(!d(o)){console.warn(`[BloomStorage] Invalid key format skipped: ${o}`);return}const n=localStorage.getItem(r);if(n!==null)try{const g=JSON.parse(n);t[o]=f(g)}catch{console.warn(`[BloomStorage] Failed to parse stored value for ${o}`)}}}),Object.keys(t).length>0&&(c({type:"storage/hydrate",payload:t}),console.log(`[BloomStorage] ðŸ”’ Securely hydrated ${Object.keys(t).length} items from localStorage`))}catch(r){console.error("[BloomStorage] Failed to hydrate from localStorage:",r)}})()},[m,i,s,c]);const p=u.useCallback(async(e,t)=>{if(!d(e))return console.warn(`[BloomStorage] Invalid key format: ${e}`),t??null;try{if(l&&l[e]!==void 0)return l[e];const r=localStorage.getItem(`${s}.${e}`);if(r!==null){const n=JSON.parse(r);return f(n)}const o=y[e];return o!==void 0?o:t!==void 0?t:null}catch(r){console.error(`[BloomStorage] Failed to get ${e}:`,r);const o=y[e];return o!==void 0?o:t??null}},[l,s]),B=u.useCallback(async(e,t)=>{if(!d(e))return console.warn(`[BloomStorage] Invalid key format: ${e}`),!1;S(t)&&console.warn(`[BloomStorage] ðŸ”’ Potential sensitive data detected in key: ${e}. Consider using secure storage.`);try{const r=f(t);return c({type:"storage/setValue",payload:{key:e,value:r}}),!0}catch(r){return console.error(`[BloomStorage] Failed to set ${e}:`,r),!1}},[c]),$=u.useCallback(async e=>{if(!d(e))return console.warn(`[BloomStorage] Invalid key format: ${e}`),!1;try{return c({type:"storage/removeValue",payload:e}),!0}catch(t){return console.error(`[BloomStorage] Failed to remove ${e}:`,t),!1}},[c]),b=u.useCallback(async e=>{if(!d(e))return!1;try{return l&&l[e]!==void 0?!0:localStorage.getItem(`${s}.${e}`)!==null}catch(t){return console.error(`[BloomStorage] Failed to check ${e}:`,t),!1}},[l,s]),v=u.useCallback(async e=>{const t={};return await Promise.all(e.map(async r=>{d(r)?t[r]=await p(r):console.warn(`[BloomStorage] Invalid key skipped: ${r}`)})),t},[p]),O=u.useCallback(async e=>{try{const t=Object.keys(e).filter(o=>!d(o));if(t.length>0){console.warn(`[BloomStorage] Invalid keys skipped: ${t.join(", ")}`);const o={};Object.entries(e).forEach(([n,g])=>{d(n)&&(o[n]=g)}),e=o}const r={};return Object.entries(e).forEach(([o,n])=>{S(n)&&console.warn(`[BloomStorage] ðŸ”’ Potential sensitive data detected in key: ${o}`),r[o]=f(n)}),c({type:"storage/setMultiple",payload:r}),!0}catch(t){return console.error("[BloomStorage] Failed to set multiple values:",t),!1}},[c]),j=u.useCallback(async()=>{try{return c({type:"storage/clearAll"}),console.log("[BloomStorage] ðŸ”’ All storage cleared securely"),!0}catch(e){return console.error("[BloomStorage] Failed to clear storage:",e),!1}},[c]),w=u.useCallback(async()=>{try{return l||{}}catch(e){return console.error("[BloomStorage] Failed to get all data:",e),{}}},[l]),F=u.useCallback(async()=>{try{let e=0,t=0,r=0;return Object.keys(localStorage).forEach(o=>{if(o.startsWith(`${s}.`)){const n=localStorage.getItem(o);if(n){e+=o.length+n.length,t++;try{const g=JSON.parse(n);S(g)&&r++}catch{}}}}),{itemCount:t,totalSize:e,totalSizeKB:Math.round(e/1024*100)/100,prefix:s,reduxItems:Object.keys(l||{}).length,isHydrated:m,securityWarnings:r,isSecure:r===0}}catch(e){return console.error("[BloomStorage] Failed to get storage info:",e),{itemCount:0,totalSize:0,totalSizeKB:0,prefix:s,reduxItems:0,isHydrated:!1,securityWarnings:0,isSecure:!0}}},[s,l,m]);return{get:p,set:B,remove:$,has:b,getMultiple:v,setMultiple:O,getAll:w,clear:j,getStorageInfo:F,isReady:m,prefix:s,state:l,dispatch:c}}export{D as u};
